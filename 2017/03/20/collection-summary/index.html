<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="纵使疾风起，人生不言弃" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="集合集合类图 Iterator: 迭代器接口,定义了hasNext,next,remove三个方法.所有集合类是实现iterator接口Collection: 集合类根接口,Set和List的父接口,定义了add,remove方法List: 有序,可以重复的元素集合接口,定义了get,set等方法,实现collection接口Set: 无序,不能重复的元素集合接口,实现collection接口Ma">
<meta property="og:type" content="article">
<meta property="og:title" content="java集合总结">
<meta property="og:url" content="http://yoursite.com/2017/03/20/collection-summary/index.html">
<meta property="og:site_name" content="nichijouYC&#39;s Blog">
<meta property="og:description" content="集合集合类图 Iterator: 迭代器接口,定义了hasNext,next,remove三个方法.所有集合类是实现iterator接口Collection: 集合类根接口,Set和List的父接口,定义了add,remove方法List: 有序,可以重复的元素集合接口,定义了get,set等方法,实现collection接口Set: 无序,不能重复的元素集合接口,实现collection接口Ma">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://note.wiz.cn/api/document/files/unzip/880d2cf7-790f-4848-acb8-b6d646096ddf/e408f6af-d2c8-4293-92e5-6cec6d49d39c.2087/index_files/ebf43c38-8cb5-4a8b-9d57-d20e4c2c6bca.png">
<meta property="og:updated_time" content="2017-08-06T09:29:56.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="java集合总结">
<meta name="twitter:description" content="集合集合类图 Iterator: 迭代器接口,定义了hasNext,next,remove三个方法.所有集合类是实现iterator接口Collection: 集合类根接口,Set和List的父接口,定义了add,remove方法List: 有序,可以重复的元素集合接口,定义了get,set等方法,实现collection接口Set: 无序,不能重复的元素集合接口,实现collection接口Ma">
<meta name="twitter:image" content="https://note.wiz.cn/api/document/files/unzip/880d2cf7-790f-4848-acb8-b6d646096ddf/e408f6af-d2c8-4293-92e5-6cec6d49d39c.2087/index_files/ebf43c38-8cb5-4a8b-9d57-d20e4c2c6bca.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"right","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> java集合总结 | nichijouYC's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-right page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">nichijouYC's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                java集合总结
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-03-20T15:07:41+08:00" content="2017-03-20">
              2017-03-20
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h3><h4 id="集合类图"><a href="#集合类图" class="headerlink" title="集合类图"></a>集合类图</h4><p><img src="https://note.wiz.cn/api/document/files/unzip/880d2cf7-790f-4848-acb8-b6d646096ddf/e408f6af-d2c8-4293-92e5-6cec6d49d39c.2087/index_files/ebf43c38-8cb5-4a8b-9d57-d20e4c2c6bca.png" alt="集合类图"></p>
<p>Iterator: 迭代器接口,定义了hasNext,next,remove三个方法.所有集合类是实现iterator接口<br>Collection: 集合类根接口,Set和List的父接口,定义了add,remove方法<br>List: 有序,可以重复的元素集合接口,定义了get,set等方法,实现collection接口<br>Set: 无序,不能重复的元素集合接口,实现collection接口<br>Map: 包含key-value对的集合接口,定义了get,put等方法</p>
<a id="more"></a>
<h4 id="List"><a href="#List" class="headerlink" title="List"></a>List</h4><ul>
<li><p>ArrayList 原理 实现 扩容 初始大小 是否线程安全 哪里线程不安全了 是否有线程安全的类 怎么实现线程安全的 区别</p>
<ul>
<li>ArrayList是一个基于动态数组实现的列表,容量可以自动增长</li>
<li>位于java.util包下,继承AbstractList类,实现List接口,RandomAccess接口(通过下标快速访问),Cloneable接口(允许被克隆),Serializable(支持序列化传输)</li>
<li>ArrayList线程不安全,在多线程环境下可以使用Collections.synchronizedList(通过每个方法加锁实现线程安全)和concurrent.CopyOnWriteArrayList(add时加reentrantlock锁,先复制一个新数组,再添加元素到新数组,再返回新数组)</li>
</ul>
<ol>
<li><p>当list一开始初始化时,数组长度为0.添加一个元素时,数组长度改为初始大小10.以后扩容为原有长度的1.5倍,若1.5倍还不够,则扩容至需求大小.扩容时使用Arrays.copyof进行复制扩容</p>
</li>
<li><p>ArrayList是线程不安全的，比如add方法：先在size下标处添加元素，再修改size++。当两个线程A、B，A在size处添加元素，还没修改size时，B又添加元素。随后AB都将size+1，则丢失了A添加的元素并且size错误。解决方案：在方法中使用synchronized (mutex) {}加锁</p>
</li>
</ol>
<ul>
<li>fast-fail:非线程安全的类都有可能抛出.在迭代时如果另一个线程在修改list结构,比如删除或者插入数据,就会抛出ConcurrentModificationException异常 快速失败.<ul>
<li>原因是因为在迭代时next()或者remove时,会先检测modCount == expectedModCount.如果有别的线程修改了 modcount会++,不等于期望的modcount,就会抛错</li>
<li>解决方案:</li>
</ul>
<ol>
<li>在所有修改modcount的地方加锁,使迭代和插入数据不会同时发生,避免fastfail.比如synchronizedlist.但是这样迭代会很慢</li>
<li>在迭代的时候先对原数组进行复制,然后在对复制的数组进行迭代遍历.比如使用copyonwritearraylist.任何对array在结构上有所改变的操作（add、remove、clear等），CopyOnWriterArrayList都会copy现有的数据，再在copy的数据上修改，这样就不会影响COWIterator中的数据了，修改完成之后改变原有数据的引用即可。缺点是会产生大量对象并且数组copy需要时间</li>
</ol>
</li>
</ul>
</li>
<li><p>CopyOnWriteArrayList<br>线程安全的arraylist,不会发生fast-fail.<br>add时加reentrantlock锁,先复制一个新数组,再添加元素到新数组,再返回新数组<br>缺点:内存占用大,并且只能保证数据最终一致性,因为只是在add时加锁,在get时没有加锁,如果一个线程写另一个线程同时读,只能读到旧数据</p>
</li>
<li><p>LinkedList</p>
<ul>
<li>LinkedList以双向链表实现,并保留头尾指针firstlast,链表无容量限制.按下标访问元素—get(i)/set(i,e) 访问时要遍历链表将指针移动到位（如果i&gt;数组大小的一半，会从末尾移起）.读慢,但是插入快</li>
</ul>
</li>
</ul>
<h4 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h4><ul>
<li>hashmap 头插法 1.8改变红黑树</li>
</ul>
<ol>
<li>位于java.util包下,基于Hash表的map接口实现,根据Hash算法计算keyvalue位置</li>
<li>线程不安全,可以使用SynchronizedMap或者ConcurrentHashMap实现线程安全.HashTable不允许null的key其他和HashMap一样并且线程安全</li>
<li>实现了map接口,clone接口和serializable接口,继承AbstractMap类</li>
<li>HashMap的迭代器(Iterator)是fail-fast迭代器</li>
<li>最多只允许一条记录的键为Null，允许多条记录的值为Null，是非同步的<ul>
<li>实现原理<br>hashmap底层是一个数组table,数组默认大小为16.负载因子是0.75 数组里的元素是Entry类,有指向下一个节点的指针,数组的每一个位置叫做桶bucket,后面挂了一条Entry链.添加节点时如果key=null,则添加到table第一个位置.按key的hashcode值在做一遍hash计算存放在数组的位置,遍历该位置的每一个entry,如果key相同则新值替换旧值,如果key不同,则将新的entry放入头部,原有的元素挂在next上(头插法,因为1.最新插入的元素可能最快读取,节省查找耗时2. 这样插入效率最高,如果插到末尾还要遍历).如果数组容量不够,则扩容2倍再添加<br>jdk1.8时 在同一个bucket位置的链表长度大于8时会将链表转换成红黑树实现</li>
<li>怎么解决hash冲突<br>散列值的冲突问题，通常是两种方法：链表法和开放地址法。链表法就是将相同hash值的对象组织成一个链表放在hash值对应的槽位；开放地址法是通过一个探测算法，当某个槽位已经被占据的情况下继续查找下一个可以使用的槽位<br>hashmap用的就是链表法</li>
<li>为什么要用hash<br>因为好的hash算法查找的速度是O(1)</li>
</ul>
</li>
</ol>
<ul>
<li><p>hashtable<br>Hashtable与HashMap类似，是HashMap的线程安全版，它支持线程的同步，即任一时刻只有一个线程能写Hashtable，因此也导致了Hashtale在写入时会比较慢，它继承自Dictionary类，不同的是它不允许记录的键或者值为null，同时效率较低</p>
</li>
<li><p>concurrenthashmap<br>线程安全，并且锁分离。ConcurrentHashMap内部使用段(Segment)来表示这些不同的部分，每个段其实就是一个小的hash table，它们有自己的锁。只要多个修改操作发生在不同的段上，它们就可以并发进行</p>
</li>
<li><p>treemap<br>TreeMap实现SortMap接口，能够把它保存的记录根据键排序，默认是按键值的升序排序（自然顺序），也可以指定排序的比较器，当用Iterator遍历TreeMap时，得到的记录是排过序的。不允许key值为空，非同步的</p>
</li>
<li><p>linkedhashmap<br>LinkedHashMap保存了记录的插入顺序，在用Iteraor遍历LinkedHashMap时，先得到的记录肯定是先插入的，在遍历的时候会比HashMap慢，有HashMap的全部特性。</p>
</li>
</ul>
<h4 id="BlockingQueue阻塞队列"><a href="#BlockingQueue阻塞队列" class="headerlink" title="BlockingQueue阻塞队列"></a>BlockingQueue阻塞队列</h4><p>一般用于生产者消费者模式和线程池,当队列为空时,消费者消费会阻塞,当队列满时,生产者生产会阻塞</p>
<ol>
<li>ArrayBlockingQueue 基于数组  FIFO先进先出原则</li>
<li>LinkedBlockingQueue：基于链表 FIFO 效率比1高 newFixedThreadPool使用</li>
<li>SynchronousQueue：不存储元素的阻塞队列。每个插入操作要等到另一个线程调用移除操作才可以执行 效率比2高 newCachedThreadPool使用</li>
<li>PriorityBlockingQueue：具有优先级的无限阻塞队列</li>
</ol>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">返回异常</th>
<th style="text-align:center">返回布尔</th>
<th style="text-align:center">阻塞等待</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">入队</td>
<td style="text-align:center">add(e)</td>
<td style="text-align:center">offer(e)</td>
<td style="text-align:center">put(e)</td>
</tr>
<tr>
<td style="text-align:center">出队</td>
<td style="text-align:center">remove()</td>
<td style="text-align:center">poll()</td>
<td style="text-align:center">take()</td>
</tr>
<tr>
<td style="text-align:center">查看</td>
<td style="text-align:center">element()</td>
<td style="text-align:center">peek()</td>
<td style="text-align:center">无</td>
</tr>
</tbody>
</table>

      
    </div>

    <div>
      
        
      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/03/15/mutlithread-lock-summary/" rel="next" title="多线程和锁相关总结">
                <i class="fa fa-chevron-left"></i> 多线程和锁相关总结
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/06/24/webx-framework/" rel="prev" title="webx framework 源码解析">
                webx framework 源码解析 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="nichijouYC" />
          <p class="site-author-name" itemprop="name">nichijouYC</p>
          <p class="site-description motion-element" itemprop="description">纵使疾风起，人生不言弃</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">24</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/nichijouyc" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#集合"><span class="nav-number">1.</span> <span class="nav-text">集合</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#集合类图"><span class="nav-number">1.1.</span> <span class="nav-text">集合类图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#List"><span class="nav-number">1.2.</span> <span class="nav-text">List</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Map"><span class="nav-number">1.3.</span> <span class="nav-text">Map</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#BlockingQueue阻塞队列"><span class="nav-number">1.4.</span> <span class="nav-text">BlockingQueue阻塞队列</span></a></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">nichijouYC</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  



  
  
  

  

  

</body>
</html>
